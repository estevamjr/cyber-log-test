{
  "swagger": "2.0",
  "info": {
    "title": "API de Processamento de Logs de Partidas (Roadmap)",
    "description": "Versão futura da API, incorporando segurança, paginação e tratamento de erros aprimorado, pronta para um ambiente de produção.",
    "version": "2.0"
  },
  "host": "api.meudominio.com",
  "basePath": "/v1",
  "schemes": [
    "https"
  ],
  "securityDefinitions": {
    "OAuth2": {
      "type": "oauth2",
      "flow": "password",
      "tokenUrl": "https://api.meudominio.com/oauth/token",
      "description": "Autenticação via OAuth 2.0 para obter um access-token.",
      "scopes": {
        "read:logs": "Permissão para ler dados de logs e rankings.",
        "write:logs": "Permissão para enviar novos logs para processamento."
      }
    }
  },
  "paths": {
    "/logs/upload": {
      "post": {
        "tags": [
          "Logs"
        ],
        "summary": "Processa um arquivo de log de partida",
        "security": [
          {
            "OAuth2": [
              "write:logs"
            ]
          }
        ],
        "description": "Faz o upload de um arquivo de log (.txt) e, opcionalmente, uma estrutura de times para processamento e persistência dos dados.",
        "consumes": [
          "multipart/form-data"
        ],
        "parameters": [
          {
            "in": "header",
            "name": "client_id",
            "description": "ID que identifica a aplicação cliente.",
            "required": true,
            "type": "string"
          },
          {
            "in": "formData",
            "name": "file",
            "description": "O arquivo de log a ser processado.",
            "required": true,
            "type": "file"
          },
          {
            "in": "formData",
            "name": "teams",
            "description": "String JSON com a estrutura de times para cálculo de friendly fire. Ex: '{\"TeamA\": [\"Player1\"], \"TeamB\": [\"Player2\"]}'",
            "required": false,
            "type": "string"
          }
        ],
        "responses": {
          "201": {
            "description": "Criado com sucesso",
            "schema": {
              "$ref": "#/definitions/UploadSuccessResponse"
            }
          },
          "400": {
            "description": "Bad Request",
            "schema": {
              "$ref": "#/definitions/DetailedErrorResponse"
            },
            "examples": {
              "application/json": {
                "message": "Validation failed",
                "name": "BadRequestError",
                "code": "400",
                "status": true,
                "errors": "File is missing or has an invalid format."
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "schema": {
              "$ref": "#/definitions/DetailedErrorResponse"
            },
            "examples": {
              "application/json": {
                "message": "Authentication failed",
                "name": "UnauthorizedError",
                "code": "401",
                "status": true,
                "errors": "Invalid or expired access token."
              }
            }
          },
          "403": {
            "description": "Forbidden",
            "schema": {
              "$ref": "#/definitions/DetailedErrorResponse"
            },
            "examples": {
              "application/json": {
                "message": "Permission denied",
                "name": "ForbiddenError",
                "code": "403",
                "status": true,
                "errors": "Client does not have the required 'write:logs' scope."
              }
            }
          },
          "415": {
            "description": "Unsupported Media Type",
            "schema": {
              "$ref": "#/definitions/DetailedErrorResponse"
            },
            "examples": {
              "application/json": {
                "message": "Unsupported Media Type",
                "name": "MediaTypeError",
                "code": "415",
                "status": true,
                "errors": "This endpoint only supports 'multipart/form-data'."
              }
            }
          },
          "500": {
            "description": "Internal Server Error",
            "schema": {
              "$ref": "#/definitions/DetailedErrorResponse"
            },
            "examples": {
              "application/json": {
                "message": "An unexpected error occurred",
                "name": "InternalServerError",
                "code": "500",
                "status": true,
                "errors": "Please contact support and provide the request ID."
              }
            }
          },
          "502": {
            "description": "Bad Gateway",
            "schema": {
              "$ref": "#/definitions/DetailedErrorResponse"
            },
            "examples": {
              "application/json": {
                "message": "Upstream service unavailable",
                "name": "BadGatewayError",
                "code": "502",
                "status": true,
                "errors": "The server, while acting as a gateway, received an invalid response from an inbound server it accessed."
              }
            }
          },
          "504": {
            "description": "Gateway Timeout",
            "schema": {
              "$ref": "#/definitions/DetailedErrorResponse"
            },
            "examples": {
              "application/json": {
                "message": "Upstream service timeout",
                "name": "GatewayTimeoutError",
                "code": "504",
                "status": true,
                "errors": "The server, while acting as a gateway, did not receive a timely response from the upstream server."
              }
            }
          }
        }
      }
    },
    "/logs/matches": {
      "get": {
        "tags": [
          "Logs"
        ],
        "summary": "Retorna uma lista resumida de todas as partidas",
        "security": [
          {
            "OAuth2": [
              "read:logs"
            ]
          }
        ],
        "description": "Retorna uma lista paginada de todas as partidas processadas, incluindo o ID interno do banco e o matchId original do log.",
        "parameters": [
          {
            "in": "header",
            "name": "client_id",
            "description": "ID que identifica a aplicação cliente.",
            "required": true,
            "type": "string"
          },
          {
            "in": "query",
            "name": "page",
            "description": "Número da página a ser retornada.",
            "required": false,
            "type": "integer",
            "default": 1
          },
          {
            "in": "query",
            "name": "limit",
            "description": "Quantidade de itens por página.",
            "required": false,
            "type": "integer",
            "default": 10
          }
        ],
        "responses": {
          "200": {
            "description": "Sucesso",
            "schema": {
              "type": "array",
              "items": {
                "$ref": "#/definitions/MatchSummary"
              }
            }
          },
          "400": {
            "description": "Bad Request",
            "schema": {
              "$ref": "#/definitions/DetailedErrorResponse"
            },
            "examples": {
              "application/json": {
                "message": "Invalid query parameters",
                "name": "BadRequestError",
                "code": "400",
                "status": true,
                "errors": "'page' and 'limit' must be positive integers."
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "schema": {
              "$ref": "#/definitions/DetailedErrorResponse"
            },
            "examples": {
              "application/json": {
                "message": "Authentication failed",
                "name": "UnauthorizedError",
                "code": "401",
                "status": true,
                "errors": "Invalid or expired access token."
              }
            }
          },
          "403": {
            "description": "Forbidden",
            "schema": {
              "$ref": "#/definitions/DetailedErrorResponse"
            },
            "examples": {
              "application/json": {
                "message": "Permission denied",
                "name": "ForbiddenError",
                "code": "403",
                "status": true,
                "errors": "Client does not have the required 'read:logs' scope."
              }
            }
          },
          "500": {
            "description": "Internal Server Error",
            "schema": {
              "$ref": "#/definitions/DetailedErrorResponse"
            },
            "examples": {
              "application/json": {
                "message": "An unexpected error occurred",
                "name": "InternalServerError",
                "code": "500",
                "status": true,
                "errors": "Please contact support and provide the request ID."
              }
            }
          },
          "502": {
            "description": "Bad Gateway",
            "schema": {
              "$ref": "#/definitions/DetailedErrorResponse"
            },
            "examples": {
              "application/json": {
                "message": "Upstream service unavailable",
                "name": "BadGatewayError",
                "code": "502",
                "status": true,
                "errors": "The server, while acting as a gateway, received an invalid response from an inbound server it accessed."
              }
            }
          },
          "504": {
            "description": "Gateway Timeout",
            "schema": {
              "$ref": "#/definitions/DetailedErrorResponse"
            },
            "examples": {
              "application/json": {
                "message": "Upstream service timeout",
                "name": "GatewayTimeoutError",
                "code": "504",
                "status": true,
                "errors": "The server, while acting as a gateway, did not receive a timely response from the upstream server."
              }
            }
          }
        }
      }
    },
    "/logs/matches/{id}": {
      "get": {
        "tags": [
          "Logs"
        ],
        "summary": "Retorna o relatório detalhado de uma partida específica",
        "security": [
          {
            "OAuth2": [
              "read:logs"
            ]
          }
        ],
        "description": "Retorna o relatório completo e detalhado de uma única partida, utilizando o matchId extraído do log.",
        "parameters": [
          {
            "in": "header",
            "name": "client_id",
            "description": "ID que identifica a aplicação cliente.",
            "required": true,
            "type": "string"
          },
          {
            "in": "path",
            "name": "id",
            "description": "O matchId da partida a ser consultada.",
            "required": true,
            "type": "string"
          }
        ],
        "responses": {
          "200": {
            "description": "Sucesso",
            "schema": {
              "$ref": "#/definitions/Match"
            }
          },
          "400": {
            "description": "Bad Request",
            "schema": {
              "$ref": "#/definitions/DetailedErrorResponse"
            },
            "examples": {
              "application/json": {
                "message": "Invalid parameter",
                "name": "BadRequestError",
                "code": "400",
                "status": true,
                "errors": "Match ID format is invalid."
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "schema": {
              "$ref": "#/definitions/DetailedErrorResponse"
            },
            "examples": {
              "application/json": {
                "message": "Authentication failed",
                "name": "UnauthorizedError",
                "code": "401",
                "status": true,
                "errors": "Invalid or expired access token."
              }
            }
          },
          "403": {
            "description": "Forbidden",
            "schema": {
              "$ref": "#/definitions/DetailedErrorResponse"
            },
            "examples": {
              "application/json": {
                "message": "Permission denied",
                "name": "ForbiddenError",
                "code": "403",
                "status": true,
                "errors": "Client does not have the required 'read:logs' scope."
              }
            }
          },
          "404": {
            "description": "Not Found",
            "schema": {
              "$ref": "#/definitions/DetailedErrorResponse"
            },
            "examples": {
              "application/json": {
                "message": "Resource not found",
                "name": "NotFoundError",
                "code": "404",
                "status": true,
                "errors": "Match with the specified ID does not exist."
              }
            }
          },
          "500": {
            "description": "Internal Server Error",
            "schema": {
              "$ref": "#/definitions/DetailedErrorResponse"
            },
            "examples": {
              "application/json": {
                "message": "An unexpected error occurred",
                "name": "InternalServerError",
                "code": "500",
                "status": true,
                "errors": "Please contact support and provide the request ID."
              }
            }
          },
          "502": {
            "description": "Bad Gateway",
            "schema": {
              "$ref": "#/definitions/DetailedErrorResponse"
            },
            "examples": {
              "application/json": {
                "message": "Upstream service unavailable",
                "name": "BadGatewayError",
                "code": "502",
                "status": true,
                "errors": "The server, while acting as a gateway, received an invalid response from an inbound server it accessed."
              }
            }
          },
          "504": {
            "description": "Gateway Timeout",
            "schema": {
              "$ref": "#/definitions/DetailedErrorResponse"
            },
            "examples": {
              "application/json": {
                "message": "Upstream service timeout",
                "name": "GatewayTimeoutError",
                "code": "504",
                "status": true,
                "errors": "The server, while acting as a gateway, did not receive a timely response from the upstream server."
              }
            }
          }
        }
      }
    },
    "/logs/ranking/global": {
      "get": {
        "tags": [
          "Logs"
        ],
        "summary": "Retorna o ranking global de jogadores",
        "security": [
          {
            "OAuth2": [
              "read:logs"
            ]
          }
        ],
        "description": "Agrega os dados de todas as partidas para gerar um ranking global paginado baseado no total de frags e mortes.",
        "parameters": [
          {
            "in": "header",
            "name": "client_id",
            "description": "ID que identifica a aplicação cliente.",
            "required": true,
            "type": "string"
          },
          {
            "in": "query",
            "name": "page",
            "description": "Número da página a ser retornada.",
            "required": false,
            "type": "integer",
            "default": 1
          },
          {
            "in": "query",
            "name": "limit",
            "description": "Quantidade de itens por página.",
            "required": false,
            "type": "integer",
            "default": 10
          }
        ],
        "responses": {
          "200": {
            "description": "Sucesso",
            "schema": {
              "type": "array",
              "items": {
                "$ref": "#/definitions/GlobalRankingPlayer"
              }
            }
          },
          "400": {
            "description": "Bad Request",
            "schema": {
              "$ref": "#/definitions/DetailedErrorResponse"
            },
            "examples": {
              "application/json": {
                "message": "Invalid query parameters",
                "name": "BadRequestError",
                "code": "400",
                "status": true,
                "errors": "'page' and 'limit' must be positive integers."
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "schema": {
              "$ref": "#/definitions/DetailedErrorResponse"
            },
            "examples": {
              "application/json": {
                "message": "Authentication failed",
                "name": "UnauthorizedError",
                "code": "401",
                "status": true,
                "errors": "Invalid or expired access token."
              }
            }
          },
          "403": {
            "description": "Forbidden",
            "schema": {
              "$ref": "#/definitions/DetailedErrorResponse"
            },
            "examples": {
              "application/json": {
                "message": "Permission denied",
                "name": "ForbiddenError",
                "code": "403",
                "status": true,
                "errors": "Client does not have the required 'read:logs' scope."
              }
            }
          },
          "500": {
            "description": "Internal Server Error",
            "schema": {
              "$ref": "#/definitions/DetailedErrorResponse"
            },
            "examples": {
              "application/json": {
                "message": "An unexpected error occurred",
                "name": "InternalServerError",
                "code": "500",
                "status": true,
                "errors": "Please contact support and provide the request ID."
              }
            }
          },
          "502": {
            "description": "Bad Gateway",
            "schema": {
              "$ref": "#/definitions/DetailedErrorResponse"
            },
            "examples": {
              "application/json": {
                "message": "Upstream service unavailable",
                "name": "BadGatewayError",
                "code": "502",
                "status": true,
                "errors": "The server, while acting as a gateway, received an invalid response from an inbound server it accessed."
              }
            }
          },
          "504": {
            "description": "Gateway Timeout",
            "schema": {
              "$ref": "#/definitions/DetailedErrorResponse"
            },
            "examples": {
              "application/json": {
                "message": "Upstream service timeout",
                "name": "GatewayTimeoutError",
                "code": "504",
                "status": true,
                "errors": "The server, while acting as a gateway, did not receive a timely response from the upstream server."
              }
            }
          }
        }
      }
    },
    "/logs/matches/mvp": {
      "get": {
        "tags": [
          "Logs"
        ],
        "summary": "Retorna o ranking de MVP baseado em prêmios",
        "security": [
          {
            "OAuth2": [
              "read:logs"
            ]
          }
        ],
        "description": "Calcula um ranking de 'Most Valuable Players' baseado em um sistema de pontuação por prêmios (Awards) conquistados em todas as partidas.",
        "parameters": [
          {
            "in": "header",
            "name": "client_id",
            "description": "ID que identifica a aplicação cliente.",
            "required": true,
            "type": "string"
          }
        ],
        "responses": {
          "200": {
            "description": "Sucesso",
            "schema": {
              "type": "array",
              "items": {
                "$ref": "#/definitions/MVPReportPlayer"
              }
            }
          },
          "400": {
            "description": "Bad Request",
            "schema": {
              "$ref": "#/definitions/DetailedErrorResponse"
            },
            "examples": {
              "application/json": {
                "message": "Invalid parameter",
                "name": "BadRequestError",
                "code": "400",
                "status": true,
                "errors": "An unexpected parameter was sent."
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "schema": {
              "$ref": "#/definitions/DetailedErrorResponse"
            },
            "examples": {
              "application/json": {
                "message": "Authentication failed",
                "name": "UnauthorizedError",
                "code": "401",
                "status": true,
                "errors": "Invalid or expired access token."
              }
            }
          },
          "403": {
            "description": "Forbidden",
            "schema": {
              "$ref": "#/definitions/DetailedErrorResponse"
            },
            "examples": {
              "application/json": {
                "message": "Permission denied",
                "name": "ForbiddenError",
                "code": "403",
                "status": true,
                "errors": "Client does not have the required 'read:logs' scope."
              }
            }
          },
          "500": {
            "description": "Internal Server Error",
            "schema": {
              "$ref": "#/definitions/DetailedErrorResponse"
            },
            "examples": {
              "application/json": {
                "message": "An unexpected error occurred",
                "name": "InternalServerError",
                "code": "500",
                "status": true,
                "errors": "Please contact support and provide the request ID."
              }
            }
          },
          "502": {
            "description": "Bad Gateway",
            "schema": {
              "$ref": "#/definitions/DetailedErrorResponse"
            },
            "examples": {
              "application/json": {
                "message": "Upstream service unavailable",
                "name": "BadGatewayError",
                "code": "502",
                "status": true,
                "errors": "The server, while acting as a gateway, received an invalid response from an inbound server it accessed."
              }
            }
          },
          "504": {
            "description": "Gateway Timeout",
            "schema": {
              "$ref": "#/definitions/DetailedErrorResponse"
            },
            "examples": {
              "application/json": {
                "message": "Upstream service timeout",
                "name": "GatewayTimeoutError",
                "code": "504",
                "status": true,
                "errors": "The server, while acting as a gateway, did not receive a timely response from the upstream server."
              }
            }
          }
        }
      }
    }
  },
  "definitions": {
    "MatchReport": {
      "type": "object",
      "properties": {
        "total_kills": {
          "type": "integer"
        },
        "players": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "ranking": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "player": {
                "type": "string"
              },
              "frags": {
                "type": "integer"
              }
            }
          }
        },
        "deaths": {
          "type": "object",
          "description": "Objeto com a contagem de mortes de cada jogador."
        },
        "streaks": {
          "type": "object",
          "description": "Objeto com a maior sequência de abates de cada jogador."
        },
        "awards": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "player": {
                "type": "string"
              },
              "award": {
                "type": "string"
              }
            }
          }
        },
        "winner_favorite_weapon": {
          "type": "string"
        }
      }
    },
    "Match": {
      "type": "object",
      "properties": {
        "id": {
          "type": "integer"
        },
        "matchId": {
          "type": "string"
        },
        "report": {
          "$ref": "#/definitions/MatchReport"
        }
      }
    },
    "UploadSuccessResponse": {
      "type": "object",
      "properties": {
        "message": {
          "type": "string"
        },
        "matches": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/Match"
          }
        }
      }
    },
    "MatchSummary": {
      "type": "object",
      "properties": {
        "id": {
          "type": "integer"
        },
        "matchId": {
          "type": "string"
        }
      }
    },
    "GlobalRankingPlayer": {
      "type": "object",
      "properties": {
        "player": {
          "type": "string"
        },
        "total_frags": {
          "type": "integer"
        },
        "total_deaths": {
          "type": "integer"
        }
      }
    },
    "MVPReportPlayer": {
      "type": "object",
      "properties": {
        "player": {
          "type": "string"
        },
        "score": {
          "type": "integer"
        },
        "awards_summary": {
          "type": "object",
          "description": "Sumário da quantidade de cada prêmio conquistado."
        }
      }
    },
    "DetailedErrorResponse": {
      "type": "object",
      "properties": {
        "message": {
          "type": "string",
          "description": "Error informations"
        },
        "name": {
          "type": "string",
          "description": "Error name"
        },
        "code": {
          "type": "string",
          "description": "Error code"
        },
        "status": {
          "type": "boolean",
          "description": "Error status"
        },
        "errors": {
          "type": "string",
          "description": "Error details"
        }
      }
    }
  }
}